<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Pocket Bowl</title>
	<style>
		:root {
			color-scheme: dark;
			font-family: "SF Mono", ui-monospace, Menlo, Consolas, monospace;
			background: #0f0f0f;
			color: #f5f5f5;
		}
		* {
			box-sizing: border-box;
		}
		body {
			margin: 0;
			min-height: 100vh;
			background: #0f0f0f;
			display: flex;
			justify-content: center;
			padding: 24px 16px 40px;
		}
		#shell {
			width: min(960px, 95vw);
			display: flex;
			flex-direction: column;
			gap: 16px;
		}
		header {
			padding: 18px 20px;
			border-radius: 16px;
			background: #171717;
			border: 1px solid #2b2b2b;
			box-shadow: 0 18px 30px rgba(0,0,0,0.35);
		}
		h1 {
			margin: 0 0 6px 0;
			font-size: 24px;
		}
		p {
			margin: 0;
			color: #c9c9c9;
			font-size: 13px;
		}
		#entryRow {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
			gap: 12px;
		}
		.entryCard {
			padding: 14px;
			border-radius: 14px;
			background: #141414;
			border: 1px solid #2b2b2b;
			display: flex;
			flex-direction: column;
			gap: 10px;
		}
		.entryCard h2 {
			margin: 0;
			font-size: 16px;
		}
		button {
			border: none;
			border-radius: 999px;
			padding: 12px 18px;
			font-weight: 700;
			background: #4aa3ff;
			color: #0c0c0c;
			cursor: pointer;
		}
		button.secondary {
			background: #2a2a2a;
			color: #f5f5f5;
		}
		#leaderboard {
			padding: 16px;
			border-radius: 16px;
			background: #151515;
			border: 1px solid #2b2b2b;
		}
		#leaderboard h2 {
			margin: 0 0 12px 0;
			font-size: 16px;
			letter-spacing: 0.4px;
		}
		#leaderboardTable {
			width: 100%;
			border-collapse: collapse;
			font-size: 12px;
		}
		#leaderboardTable thead th {
			text-align: left;
			padding: 6px 4px;
			color: #bdbdbd;
			border-bottom: 1px solid #2b2b2b;
		}
		#leaderboardTable tbody td {
			padding: 6px 4px;
			border-bottom: 1px solid #242424;
		}
		#leaderboardTable tbody tr:last-child td {
			border-bottom: none;
		}
		.badge {
			display: inline-flex;
			align-items: center;
			padding: 2px 8px;
			border-radius: 999px;
			background: rgba(255, 213, 74, 0.1);
			color: #ffd54a;
			font-weight: 700;
			font-size: 11px;
		}
	</style>
</head>
<body>
	<div id="shell">
		<header>
			<h1>POCKET BOWL</h1>
			<p>Select a version and view the global highscores below.</p>
		</header>

		<section id="entryRow">
			<div class="entryCard">
				<h2>Desktop / Web</h2>
				<p>Full keyboard controls and classic layout.</p>
				<button id="openWeb" type="button">OPEN WEB GAME</button>
			</div>
			<div class="entryCard">
				<h2>iPhone / Safari</h2>
				<p>Touch controls, tap or hold to pass.</p>
				<button id="openIos" class="secondary" type="button">OPEN IOS GAME</button>
			</div>
		</section>

		<section id="leaderboard">
			<h2>GLOBAL HIGHSCORES</h2>
			<table id="leaderboardTable">
				<thead>
					<tr>
						<th>Rank</th>
						<th>Username</th>
						<th>Score</th>
						<th>Date</th>
					</tr>
				</thead>
				<tbody id="leaderboardBody">
					<tr><td colspan="4">Loading...</td></tr>
				</tbody>
			</table>
		</section>
	</div>

	<script type="module">
		import { fetchHighscores, initFirebase } from "./firebase/firebase.js";

		const leaderboardBody = document.getElementById("leaderboardBody");
		const openWeb = document.getElementById("openWeb");
		const openIos = document.getElementById("openIos");

		openWeb.addEventListener("click", () => {
			window.location.href = "./web/index.html";
		});
		openIos.addEventListener("click", () => {
			window.location.href = "./iphone/index.html";
		});

		initFirebase();

		async function refreshLeaderboard() {
			if (!leaderboardBody) return;
			leaderboardBody.innerHTML = "<tr><td colspan=\"4\">Loading...</td></tr>";
			try {
				const entries = await fetchHighscores(10);
				leaderboardBody.innerHTML = "";
				if (!entries.length) {
					leaderboardBody.innerHTML = "<tr><td colspan=\"4\">No scores yet.</td></tr>";
					return;
				}
				entries.forEach((entry, index) => {
					const row = document.createElement("tr");
					const rank = index + 1;
					const username = String(entry.username ?? "Anonymous").slice(0, 16);
					const score = Number(entry.score ?? 0);
					const date = entry.date ? String(entry.date) : "";
					row.innerHTML = `
						<td><span class="badge">#${rank}</span></td>
						<td>${username}</td>
						<td>${score}</td>
						<td>${date}</td>
					`;
					leaderboardBody.appendChild(row);
				});
			} catch (error) {
				console.error(error);
				leaderboardBody.innerHTML = "<tr><td colspan=\"4\">Unable to load scores.</td></tr>";
			}
		}

		refreshLeaderboard();
	</script>
</body>
</html>
